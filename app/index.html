<!DOCTYPE html>
<html>
  <head>
    <title>Calculateur de performance en course à pied</title>
    <script type="text/javascript" src="script.js"></script>
    <link rel="stylesheet" href="style.css">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  <body>
    <!-- Ajout du menu -->
    <nav>
      <ul>
        <li><a style="text-decoration:none;" href="changelog.txt">Version : 1.1.0</a></li>
        <li id="weather">Météo : chargement.</li>
      </ul>
    </nav>
    <h1 class="title">Calculateur de performance en course à pied</h1>
    <form class="input-data">
      <label for="distance">Distance parcourue (en mètres) :</label><br />
      <input
        type="number"
        id="distance"
        name="distance"
        min="0"
        oninput="calculatePerformance(); calculatePassageTime();"
      /><br />
      <div class="buttons">
        <button type="button" onclick="document.getElementById('distance').value = 42195; calculatePerformance(); calculatePassageTime();">42 km</button>
        <button type="button" onclick="document.getElementById('distance').value = 21100; calculatePerformance(); calculatePassageTime();">21 km</button>
        <button type="button" onclick="document.getElementById('distance').value = 15000; calculatePerformance(); calculatePassageTime();">15 km</button>
        <button type="button" onclick="document.getElementById('distance').value = 10000; calculatePerformance(); calculatePassageTime();">10 km</button>
        <button type="button" onclick="document.getElementById('distance').value = 5000; calculatePerformance(); calculatePassageTime();">5 km</button>
        <button type="button" onclick="document.getElementById('distance').value = 1000; calculatePerformance(); calculatePassageTime();">1 km</button>
      </div>
      <br />
      <label for="hours">Temps effectué (heures) :</label><br />
      <input
        type="number"
        id="hours"
        name="hours"
        min="0"
        oninput="calculatePerformance(); calculatePassageTime();"
      /><br />
      <br />
      <label for="minutes">Temps effectué (minutes) :</label><br />
      <input
        type="number"
        id="minutes"
        name="minutes"
        min="0"
        oninput="calculatePerformance(); calculatePassageTime();"
      /><br />
      <br />
      <label for="seconds">Temps effectué (secondes) :</label><br />
      <input
        type="number"
        id="seconds"
        name="seconds"
        min="0"
        oninput="calculatePerformance(); calculatePassageTime();"
      /><br />
      <br />
      <label for="passageKm">Distance à laquelle calculer le temps de passage (en km) :</label><br />
      <input type="number" id="passageKm" name="passageKm" min="0" oninput="calculatePassageTime()"/><br />
      <br />
    </form>
    <br />
    <div class="results">
      <strong>Vitesse (KM/H) :</strong> <span id="speedKMH"></span><br />
      <strong>Vitesse (minutes/KM) :</strong> <span id="speedMinPerKM"></span><br />
      <strong>Temps de passage :</strong> <span id="passageTime"></span>
    </div>
  </body>
  <script>
    async function fetchWeatherData(lat, lon) {
      const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
      const apiUrl = `https://www.metaweather.com/api/location/search/?lattlong=${lat},${lon}`;

      try {
        const response = await fetch(proxyUrl + apiUrl);
        const data = await response.json();
        const location = data[0];

        if (location) {
          const weatherResponse = await fetch(
            proxyUrl + `https://www.metaweather.com/api/location/${location.woeid}/`
          );
          const weatherData = await weatherResponse.json();
          const currentWeather = weatherData.consolidated_weather[0];

          return {
            temperature: currentWeather.the_temp,
            weather: currentWeather.weather_state_name,
          };
        } else {
          throw new Error('Location not found');
        }
      } catch (error) {
        console.error('Error fetching weather data:', error);
        return null;
      }
    }

    function displayWeatherData(data) {
      const weatherDescription = data.weather[0].description;
      const temperature = data.main.temp;
      const locationName = data.name;

      const weatherElement = document.getElementById('weather').innerHTML = `${weatherData.weather}, ${weatherData.temperature.toFixed(1)}°C`;
      weatherElement.innerHTML = `
        Lieu: ${locationName} <br>
        Temps: ${weatherDescription} <br>
        Température: ${temperature}°C
      `;
    }
  </script>
</html>